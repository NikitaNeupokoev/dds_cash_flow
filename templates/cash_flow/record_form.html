{% extends 'cash_flow/base.html' %}

{% block title %}{% if object %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏{% else %}–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏{% endif %}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">{% if object %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å{% else %}–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å{% endif %}</h4>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    {% if form.errors %}
                    <div class="alert alert-danger">
                        <strong>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏:</strong>
                        <ul class="mb-0 mt-2">
                            {% for field, errors in form.errors.items %}
                                {% for error in errors %}
                                    <li>{{ error }}</li>
                                {% endfor %}
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                    
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="id_operation_date" class="form-label">–î–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ *</label>
                            {{ form.operation_date }}
                        </div>
                        
                        <div class="col-md-6">
                            <label for="id_status" class="form-label">–°—Ç–∞—Ç—É—Å *</label>
                            {{ form.status }}
                        </div>
                        
                        <div class="col-md-6">
                            <label for="id_type" class="form-label">–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ *</label>
                            {{ form.type }}
                            <div class="form-text">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø, –∑–∞—Ç–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</div>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="id_category" class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                            {{ form.category }}
                            <div class="form-text">
                                {% if form.type.value %}
                                    –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è "{{ form.type.value }}":
                                    {% for category in all_categories %}
                                        {% if category.type.id == form.type.value %}
                                            {{ category.name }}{% if not forloop.last %}, {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                {% else %}
                                    –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="id_subcategory" class="form-label">–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                            {{ form.subcategory }}
                            <div class="form-text">
                                {% if form.category.value %}
                                    –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
                                    {% for subcategory in all_subcategories %}
                                        {% if subcategory.category.id == form.category.value %}
                                            {{ subcategory.name }}{% if not forloop.last %}, {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                {% else %}
                                    –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="id_amount" class="form-label">–°—É–º–º–∞ (—Ä—É–±) *</label>
                            {{ form.amount }}
                        </div>
                        
                        <div class="col-12">
                            <label for="id_description" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                            {{ form.description }}
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <button type="submit" class="btn btn-success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <a href="{% url 'cash_flow:record_list' %}" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ —Å–≤—è–∑—è–º -->
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">üìã –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Å–≤—è–∑–µ–π</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    {% for type in all_types %}
                    <div class="col-md-6 mb-3">
                        <strong>{{ type.name }}:</strong>
                        <ul class="mb-0">
                            {% for category in all_categories %}
                                {% if category.type == type %}
                                    <li>
                                        {{ category.name }}
                                        <ul>
                                            {% for subcategory in category.subcategories.all %}
                                                <li>{{ subcategory.name }}</li>
                                            {% endfor %}
                                        </ul>
                                    </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascript %}
<!-- –ë–µ–∑ JavaScript - —á–∏—Å—Ç—ã–π HTML -->
{% endblock %}
